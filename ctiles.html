<!DOCTYPE html>
<html><head><title>JavaScript Tile Demo</title></head>

<body>
<h1>JavaScript Tile Demo</h1>
<canvas id="canvas" width="100" height="100"></canvas>
<!-- now include all our javascript -->
<script src="./global.js"></script>
<script src="./tokenize.js"></script>
<script src="./parse.js"></script>
<script src="./ccanvas.js"></script>
<script src="./crender.js"></script>
<script src="./tests.js"></script>
<pre id="output"><script>
Object.prototype.error = function (message, t) {
    t = t || this;
    t.name = "SyntaxError";
    t.message = message;
    console.log(t);
    throw t;
};
var tests = make_tests(make_parse, make_crender);
var isource = "";
//isource = tests[tests.length-2];
//isource='{console=2+3;return this;}';
//isource='var a,b="test\\n",c,d,e;console=typeof !3;while(!2&&3||4) {console=2*3/4;var z;break;} console=console; function foo (y) {return false;}';
//isource = tests[0].replace(/module/,'make_tests');
//isource = 'var a = 1 + 2;';
//isource = "function foo() { while(true) { return 3; } };";
//isource = "console = 1 + 2 + 3 + 4 + 5;";
//isource += "console = !3 + !function(x) { return function(){}; };";
//isource += "console = 3 - 4 + 5 - function(x) { return function(){}; };";
//isource += "console = (3 + function (x) { return x; }) + function(){};";
//isource += "console = function(x) { /*return x;*/ };";
//isource += "console = !1 + 2 * 3;";
//isource += "console = !function (x) { return x; } + function(){};";
//isource = "while (function(x) { return x; }+(true)) { return false; }";
//isource += "if (function(x) { return x; }+(true)) { return false; } else { return true; }";
//isource += "var a = console.log(function() { },3);";
//isource += "console(1, 2, 3+4);console(1,function(a,b){},3,function(c,d){});console[function(e,f){}]=1;";
//isource = "function foo(a) { return a(a,function(){}); }; function bar(b){}";
isource = tests[0];
//isource = tests[1];
//isource = "console.a = console.b(2, function() { }, 3);";
//isource += "console.log(1, console.log(2, function(){}), 3);";
//isource += "console.log(1, console.log(2, function(){}), function(){});";
//isource = "console = { foo: 'bar', bat: {}, console:console };";

// parse the example source
var top_level = "isFinite parseInt Boolean String Function Math "+
                "console arguments";
var parse = make_parse(tokenize);
var tree = parse(isource, top_level);

// make widgets from parse tree
var crender = make_crender();
var widget = crender(tree);

// draw the widgets!
var canvas = make_canvas('canvas');
var styles = {
   textHeight: 20,
   tilePadding: { left: 4, top: 1, right: 3, bottom: 5},
   textColor: canvas.makeColor(0, 0, 0),
   nameColor: canvas.makeColor(160, 82, 45), // variable names
   commentColor: canvas.makeColor(178, 34, 34), // comments
   keywordColor: canvas.makeColor(160, 32, 240),// keywords
   constColor: canvas.makeColor(0, 139, 139), // constants,this,arguments
   slotColor: canvas.makeColor(0, 0, 255), // slots in objects
   literalColor: canvas.makeColor(139, 34, 82), // string literals
   semiColor: canvas.makeColor(0, 0, 0, 76),// semicolon
   tileColor: canvas.makeColor(253, 250, 235),
   tileOutlineColor: canvas.makeColor(255, 204, 106, 125),
   yadaColor: canvas.makeColor(249, 250, 215, 0), // background of ... expr
   stmtColor: canvas.makeColor(253, 250, 215),
   tileCornerRadius: 4,
   puzzleIndent: 5,
   puzzleRadius: 5,
   expHalfHeight: 12,
   expWidth: 6,
   expUnderHeight: 5,
   expUnderWidth: 5, /* underline when it's running along the sides */
   blockIndent: 26,
   objIndent: 12, /* indent for the slot names in an object initializer */
   blockBottomPadding: 8, /* below last tile in a block */
   functionIndent: 5, /* thin line on left side of function */
   functionNameSpace: 3, /* space to leave for a missing function name */
   listEndPadding: 0, /* empty space on right side of lists */
   commaBreakWidth: 600, /* line wrapping HACK */
};
if (0) {
// for debugging
  styles = {
    __proto__: styles,
    tileColor: canvas.makeColor(253, 250, 235, 10),
    tileOutlineColor: canvas.makeColor(255, 204, 106, 205),
    expUnderHeight: 8,
    expUnderWidth: 8, /* underline when it's running along the sides */
    functionIndent: 8, /* thin line on left side of function */
    functionNameSpace: 8,
  };
}

widget.layout(canvas, styles, {margin: 0, lineHeight: 0});
var cElem = document.getElementById('canvas');
cElem.width = Math.min(widget.bbox.width(), 8000)+10;
cElem.height = Math.min(widget.bbox.height(), 30000)+10;
canvas.translate(5,5);
widget.draw();

</script></pre>
</body> </html>
