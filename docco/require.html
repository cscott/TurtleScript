<!DOCTYPE html>

<html>
<head>
  <title>require.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="asm-llvm.html">
                asm-llvm.js
              </a>
            
              
              <a class="source" href="bcompile.html">
                bcompile.js
              </a>
            
              
              <a class="source" href="binterp.html">
                binterp.js
              </a>
            
              
              <a class="source" href="browsercanvas.html">
                browsercanvas.js
              </a>
            
              
              <a class="source" href="bytecode-table.html">
                bytecode-table.js
              </a>
            
              
              <a class="source" href="canvastest.html">
                canvastest.js
              </a>
            
              
              <a class="source" href="ccanvas.html">
                ccanvas.js
              </a>
            
              
              <a class="source" href="crender-styles.html">
                crender-styles.js
              </a>
            
              
              <a class="source" href="crender.html">
                crender.js
              </a>
            
              
              <a class="source" href="ctiles.html">
                ctiles.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="eventtests.html">
                eventtests.js
              </a>
            
              
              <a class="source" href="extensions.html">
                extensions.js
              </a>
            
              
              <a class="source" href="global-es5.html">
                global-es5.js
              </a>
            
              
              <a class="source" href="global.html">
                global.js
              </a>
            
              
              <a class="source" href="html-escape.html">
                html-escape.js
              </a>
            
              
              <a class="source" href="jcompile.html">
                jcompile.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="nodemain.html">
                nodemain.js
              </a>
            
              
              <a class="source" href="parse.html">
                parse.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="render2.html">
                render2.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="stdlib.html">
                stdlib.js
              </a>
            
              
              <a class="source" href="str-escape.html">
                str-escape.js
              </a>
            
              
              <a class="source" href="tdop.html">
                tdop.js
              </a>
            
              
              <a class="source" href="tests.html">
                tests.js
              </a>
            
              
              <a class="source" href="text.html">
                text.js
              </a>
            
              
              <a class="source" href="tiles.html">
                tiles.js
              </a>
            
              
              <a class="source" href="tokenize.html">
                tokenize.js
              </a>
            
              
              <a class="source" href="top-level.html">
                top-level.js
              </a>
            
              
              <a class="source" href="ts.html">
                ts.js
              </a>
            
              
              <a class="source" href="write-lua-bytecode.html">
                write-lua-bytecode.js
              </a>
            
              
              <a class="source" href="write-lua-ops.html">
                write-lua-ops.js
              </a>
            
              
              <a class="source" href="write-php-bytecode.html">
                write-php-bytecode.js
              </a>
            
              
              <a class="source" href="write-php-ops.html">
                write-php-ops.js
              </a>
            
              
              <a class="source" href="write-rust-bytecode.html">
                write-rust-bytecode.js
              </a>
            
              
              <a class="source" href="write-rust-ops.html">
                write-rust-ops.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>require.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/** vim: et:ts=4:sw=4:sts=4
 * <span class="hljs-doctag">@license </span>RequireJS 0.24.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */</span>
<span class="hljs-comment">/*jslint strict: false, plusplus: false */</span>
<span class="hljs-comment">/*global window: false, navigator: false, document: false, importScripts: false,
  jQuery: false, clearInterval: false, setInterval: false, self: false,
  setTimeout: false, opera: false */</span>

<span class="hljs-keyword">var</span> <span class="hljs-built_in">require</span>, define;
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Change this version number for each release.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> version = <span class="hljs-string">"0.24.0"</span>,
        commentRegExp = <span class="hljs-regexp">/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg</span>,
        cjsRequireRegExp = <span class="hljs-regexp">/require\(["']([^'"\s]+)["']\)/g</span>,
        currDirRegExp = <span class="hljs-regexp">/^\.\//</span>,
        jsSuffixRegExp = <span class="hljs-regexp">/\.js$/</span>,
        ostring = <span class="hljs-built_in">Object</span>.prototype.toString,
        ap = <span class="hljs-built_in">Array</span>.prototype,
        aps = ap.slice,
        apsp = ap.splice,
        isBrowser = !!(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">"undefined"</span> &amp;&amp; navigator &amp;&amp; <span class="hljs-built_in">document</span>),
        isWebWorker = !isBrowser &amp;&amp; <span class="hljs-keyword">typeof</span> importScripts !== <span class="hljs-string">"undefined"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>PS3 indicates loaded and complete, but need to wait for complete
specifically. Sequence is &quot;loading&quot;, &quot;loaded&quot;, execution,
then &quot;complete&quot;. The UA check is unfortunate, but not sure how
to feature test w/o causing perf issues.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        readyRegExp = isBrowser &amp;&amp; navigator.platform === <span class="hljs-string">'PLAYSTATION 3'</span> ?
                      <span class="hljs-regexp">/^complete$/</span> : <span class="hljs-regexp">/^(complete|loaded)$/</span>,
        defContextName = <span class="hljs-string">"_"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Oh the tragedy, detecting opera. See the usage of isOpera for reason.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isOpera = <span class="hljs-keyword">typeof</span> opera !== <span class="hljs-string">"undefined"</span> &amp;&amp; opera.toString() === <span class="hljs-string">"[object Opera]"</span>,
        reqWaitIdPrefix = <span class="hljs-string">"_r@@"</span>,
        empty = {},
        contexts = {},
        globalDefQueue = [],
        interactiveScript = <span class="hljs-literal">null</span>,
        isDone = <span class="hljs-literal">false</span>,
        useInteractive = <span class="hljs-literal">false</span>,
        req, cfg = {}, currentlyAddingScript, s, head, baseElement, scripts, script,
        src, subPath, mainScript, dataMain, i, scrollIntervalId, setReadyState, ctx;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFunction</span>(<span class="hljs-params">it</span>) </span>{
        <span class="hljs-keyword">return</span> ostring.call(it) === <span class="hljs-string">"[object Function]"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span>(<span class="hljs-params">it</span>) </span>{
        <span class="hljs-keyword">return</span> ostring.call(it) === <span class="hljs-string">"[object Array]"</span>;
    }

    <span class="hljs-comment">/**
     * Simple function to mix in properties from source into target,
     * but only if target does not already have a property of the same name.
     * This is not robust in IE for transferring methods that match
     * Object.prototype names, but the uses of mixin here seem unlikely to
     * trigger a problem related to that.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mixin</span>(<span class="hljs-params">target, source, force</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> source) {
            <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty) &amp;&amp; (!(prop <span class="hljs-keyword">in</span> target) || force)) {
                target[prop] = source[prop];
            }
        }
        <span class="hljs-keyword">return</span> req;
    }

    <span class="hljs-comment">/**
     * Used to set up package paths from a packagePaths or packages config object.
     * <span class="hljs-doctag">@param <span class="hljs-type">{Object}</span> </span>pkgs the object to store the new package config
     * <span class="hljs-doctag">@param <span class="hljs-type">{Array}</span> </span>currentPackages an array of packages to configure
     * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>[dir] a prefix dir to use.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configurePackageDir</span>(<span class="hljs-params">pkgs, currentPackages, dir</span>) </span>{
        <span class="hljs-keyword">var</span> i, location, pkgObj;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (pkgObj = currentPackages[i]); i++) {
            pkgObj = <span class="hljs-keyword">typeof</span> pkgObj === <span class="hljs-string">"string"</span> ? { <span class="hljs-attr">name</span>: pkgObj } : pkgObj;
            location = pkgObj.location;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Add dir to the path, but avoid paths that start with a slash
or have a colon (indicates a protocol)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (dir &amp;&amp; (!location || (location.indexOf(<span class="hljs-string">"/"</span>) !== <span class="hljs-number">0</span> &amp;&amp; location.indexOf(<span class="hljs-string">":"</span>) === <span class="hljs-number">-1</span>))) {
                location = dir + <span class="hljs-string">"/"</span> + (location || pkgObj.name);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create a brand new object on pkgs, since currentPackages can
be passed in again, and config.pkgs is the internal transformed
state for all package configs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            pkgs[pkgObj.name] = {
                <span class="hljs-attr">name</span>: pkgObj.name,
                <span class="hljs-attr">location</span>: location || pkgObj.name,
                <span class="hljs-attr">lib</span>: pkgObj.lib || <span class="hljs-string">"lib"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Remove leading dot in main, so main paths are normalized,
and remove any trailing .js, since different package
envs have different conventions: some use a module name,
some use a file name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                main: (pkgObj.main || <span class="hljs-string">"lib/main"</span>)
                      .replace(currDirRegExp, <span class="hljs-string">''</span>)
                      .replace(jsSuffixRegExp, <span class="hljs-string">''</span>)
            };
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Check for an existing version of require. If so, then exit out. Only allow
one version of require to be active in a page. However, allow for a require
config object, just exit quickly if require is an actual function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">require</span> !== <span class="hljs-string">"undefined"</span>) {
        <span class="hljs-keyword">if</span> (isFunction(<span class="hljs-built_in">require</span>)) {
            <span class="hljs-keyword">return</span>;
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>assume it is a config object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cfg = <span class="hljs-built_in">require</span>;
        }
    }

    <span class="hljs-comment">/**
     * Creates a new context for use in require and define calls.
     * Handle most of the heavy lifting. Do not want to use an object
     * with prototype here to avoid using "this" in require, in case it
     * needs to be used in more super secure envs that do not want this.
     * Also there should not be that many contexts in the page. Usually just
     * one for the default context, but could be extra for multiversion cases
     * or if a package needs a special context for a dependency that conflicts
     * with the standard context.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newContext</span>(<span class="hljs-params">contextName</span>) </span>{
        <span class="hljs-keyword">var</span> context, resume,
            config = {
                <span class="hljs-attr">waitSeconds</span>: <span class="hljs-number">7</span>,
                <span class="hljs-attr">baseUrl</span>: s.baseUrl || <span class="hljs-string">"./"</span>,
                <span class="hljs-attr">paths</span>: {},
                <span class="hljs-attr">pkgs</span>: {}
            },
            defQueue = [],
            specified = {
                <span class="hljs-string">"require"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-string">"exports"</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-string">"module"</span>: <span class="hljs-literal">true</span>
            },
            urlMap = {},
            defined = {},
            loaded = {},
            waiting = {},
            waitAry = [],
            waitIdCounter = <span class="hljs-number">0</span>,
            managerCallbacks = {},
            plugins = {},
            pluginsQueue = {},
            resumeDepth = <span class="hljs-number">0</span>,
            normalizedWaiting = {};

        <span class="hljs-comment">/**
         * Trims the . and .. from an array of path segments.
         * It will keep a leading path segment if a .. will become
         * the first path segment, to help with module name lookups,
         * which act like paths, but can be remapped. But the end result,
         * all paths that use this function should look normalized.
         * <span class="hljs-doctag">NOTE:</span> this method MODIFIES the input array.
         * @param {Array} ary the array of path segments.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimDots</span>(<span class="hljs-params">ary</span>) </span>{
            <span class="hljs-keyword">var</span> i, part;
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (part = ary[i]); i++) {
                <span class="hljs-keyword">if</span> (part === <span class="hljs-string">"."</span>) {
                    ary.splice(i, <span class="hljs-number">1</span>);
                    i -= <span class="hljs-number">1</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (part === <span class="hljs-string">".."</span>) {
                    <span class="hljs-keyword">if</span> (i === <span class="hljs-number">1</span> &amp;&amp; (ary[<span class="hljs-number">2</span>] === <span class="hljs-string">'..'</span> || ary[<span class="hljs-number">0</span>] === <span class="hljs-string">'..'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>End of the line. Keep at least one non-dot
path segment at the front so it can be mapped
correctly to disk. Otherwise, there is likely
no path mapping for a path starting with &#39;..&#39;.
This can still fail, but catches the most reasonable
uses of ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">break</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
                        ary.splice(i - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
                        i -= <span class="hljs-number">2</span>;
                    }
                }
            }
        }

        <span class="hljs-comment">/**
         * Given a relative module name, like ./something, normalize it to
         * a real name that can be mapped to a path.
         * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>name the relative name
         * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>baseName a real name that the name arg is relative
         * to.
         * <span class="hljs-doctag">@returns <span class="hljs-type">{String}</span> </span>normalized name
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalize</span>(<span class="hljs-params">name, baseName</span>) </span>{
            <span class="hljs-keyword">var</span> pkgName, pkgConfig;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Adjust any relative paths.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (name.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"."</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>If have a base name, try to normalize against it,
otherwise, assume it is a top-level require that will
be relative to baseUrl in the end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (baseName) {
                    <span class="hljs-keyword">if</span> (config.pkgs[baseName]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If the baseName is a package name, then just treat it as one
name to concat the name with.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        baseName = [baseName];
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Convert baseName to array, and lop off the last part,
so that . matches that &quot;directory&quot; and not name of the baseName&#39;s
module. For instance, baseName of &quot;one/two/three&quot;, maps to
&quot;one/two/three.js&quot;, but we want the directory, &quot;one/two&quot; for
this normalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        baseName = baseName.split(<span class="hljs-string">"/"</span>);
                        baseName = baseName.slice(<span class="hljs-number">0</span>, baseName.length - <span class="hljs-number">1</span>);
                    }

                    name = baseName.concat(name.split(<span class="hljs-string">"/"</span>));
                    trimDots(name);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Some use of packages may use a . path to reference the
&quot;main&quot; module name, so normalize for that.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    pkgConfig = config.pkgs[(pkgName = name[<span class="hljs-number">0</span>])];
                    name = name.join(<span class="hljs-string">"/"</span>);
                    <span class="hljs-keyword">if</span> (pkgConfig &amp;&amp; name === pkgName + <span class="hljs-string">'/'</span> + pkgConfig.main) {
                        name = pkgName;
                    }
                }
            }
            <span class="hljs-keyword">return</span> name;
        }

        <span class="hljs-comment">/**
         * Creates a module mapping that includes plugin prefix, module
         * name, and path. If parentModuleMap is provided it will
         * also normalize the name via require.normalize()
         *
         * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>name the module name
         * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>[parentModuleMap] parent module map
         * for the module name, used to resolve relative names.
         *
         * <span class="hljs-doctag">@returns <span class="hljs-type">{Object}</span></span>
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeModuleMap</span>(<span class="hljs-params">name, parentModuleMap</span>) </span>{
            <span class="hljs-keyword">var</span> index = name ? name.indexOf(<span class="hljs-string">"!"</span>) : <span class="hljs-number">-1</span>,
                prefix = <span class="hljs-literal">null</span>,
                parentName = parentModuleMap ? parentModuleMap.name : <span class="hljs-literal">null</span>,
                originalName = name,
                normalizedName, url, pluginModule;

            <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
                prefix = name.substring(<span class="hljs-number">0</span>, index);
                name = name.substring(index + <span class="hljs-number">1</span>, name.length);
            }

            <span class="hljs-keyword">if</span> (prefix) {
                prefix = normalize(prefix, parentName);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Account for relative paths if there is a base name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (name) {
                <span class="hljs-keyword">if</span> (prefix) {
                    pluginModule = defined[prefix];
                    <span class="hljs-keyword">if</span> (pluginModule) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Plugin is loaded, use its normalize method, otherwise,
normalize name as usual.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (pluginModule.normalize) {
                            normalizedName = pluginModule.normalize(name, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
                                <span class="hljs-keyword">return</span> normalize(name, parentName);
                            });
                        } <span class="hljs-keyword">else</span> {
                            normalizedName = normalize(name, parentName);
                        }
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Plugin is not loaded yet, so do not normalize
the name, wait for plugin to load to see if
it has a normalize method. To avoid possible
ambiguity with relative names loaded from another
plugin, use the parent&#39;s name as part of this name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        normalizedName = <span class="hljs-string">'__$p'</span> + parentName + <span class="hljs-string">'@'</span> + name;
                    }
                } <span class="hljs-keyword">else</span> {
                    normalizedName = normalize(name, parentName);
                }

                url = urlMap[normalizedName];
                <span class="hljs-keyword">if</span> (!url) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Calculate url for the module, if it has a name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (req.toModuleUrl) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Special logic required for a particular engine,
like Node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        url = req.toModuleUrl(context, name, parentModuleMap);
                    } <span class="hljs-keyword">else</span> {
                        url = context.nameToUrl(name, <span class="hljs-literal">null</span>, parentModuleMap);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Store the URL mapping for later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    urlMap[normalizedName] = url;
                }
            }

            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">prefix</span>: prefix,
                <span class="hljs-attr">name</span>: normalizedName,
                <span class="hljs-attr">parentMap</span>: parentModuleMap,
                <span class="hljs-attr">url</span>: url,
                <span class="hljs-attr">originalName</span>: originalName,
                <span class="hljs-attr">fullName</span>: prefix ? prefix + <span class="hljs-string">"!"</span> + normalizedName : normalizedName
            };
        }

        <span class="hljs-comment">/**
         * Determine if priority loading is done. If so clear the priorityWait
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPriorityDone</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> priorityDone = <span class="hljs-literal">true</span>,
                priorityWait = config.priorityWait,
                priorityName, i;
            <span class="hljs-keyword">if</span> (priorityWait) {
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (priorityName = priorityWait[i]); i++) {
                    <span class="hljs-keyword">if</span> (!loaded[priorityName]) {
                        priorityDone = <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (priorityDone) {
                    <span class="hljs-keyword">delete</span> config.priorityWait;
                }
            }
            <span class="hljs-keyword">return</span> priorityDone;
        }

        <span class="hljs-comment">/**
         * Helper function that creates a setExports function for a "module"
         * CommonJS dependency. Do this here to avoid creating a closure that
         * is part of a loop.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeSetExports</span>(<span class="hljs-params">moduleObj</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">exports</span>) </span>{
                moduleObj.exports = exports;
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeContextModuleFunc</span>(<span class="hljs-params">func, relModuleMap, enableBuildCallback</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>A version of a require function that passes a moduleName
value for items that may need to
look up paths relative to the moduleName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> args = [].concat(aps.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>)), lastArg;
                <span class="hljs-keyword">if</span> (enableBuildCallback &amp;&amp;
                    isFunction((lastArg = args[args.length - <span class="hljs-number">1</span>]))) {
                    lastArg.__requireJsBuild = <span class="hljs-literal">true</span>;
                }
                args.push(relModuleMap);
                <span class="hljs-keyword">return</span> func.apply(<span class="hljs-literal">null</span>, args);
            };
        }

        <span class="hljs-comment">/**
         * Helper function that creates a require function object to give to
         * modules that ask for it as a dependency. It needs to be specific
         * per module because of the implication of path mappings that may
         * need to be relative to the module name.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeRequire</span>(<span class="hljs-params">relModuleMap, enableBuildCallback</span>) </span>{
            <span class="hljs-keyword">var</span> modRequire = makeContextModuleFunc(context.require, relModuleMap, enableBuildCallback);

            mixin(modRequire, {
                <span class="hljs-attr">nameToUrl</span>: makeContextModuleFunc(context.nameToUrl, relModuleMap),
                <span class="hljs-attr">toUrl</span>: makeContextModuleFunc(context.toUrl, relModuleMap),
                <span class="hljs-attr">isDefined</span>: makeContextModuleFunc(context.isDefined, relModuleMap),
                <span class="hljs-attr">ready</span>: req.ready,
                <span class="hljs-attr">isBrowser</span>: req.isBrowser
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Something used by node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (req.paths) {
                modRequire.paths = req.paths;
            }
            <span class="hljs-keyword">return</span> modRequire;
        }

        <span class="hljs-comment">/**
         * Used to update the normalized name for plugin-based dependencies
         * after a plugin loads, since it can have its own normalization structure.
         * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>pluginName the normalized plugin module name.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateNormalizedNames</span>(<span class="hljs-params">pluginName</span>) </span>{

            <span class="hljs-keyword">var</span> oldFullName, oldModuleMap, moduleMap, fullName, callbacks,
                i, j, k, depArray, existingCallbacks,
                maps = normalizedWaiting[pluginName];

            <span class="hljs-keyword">if</span> (maps) {
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (oldModuleMap = maps[i]); i++) {
                    oldFullName = oldModuleMap.fullName;
                    moduleMap = makeModuleMap(oldModuleMap.originalName, oldModuleMap.parentMap);
                    fullName = moduleMap.fullName;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Callbacks could be undefined if the same plugin!name was
required twice in a row, so use empty array in that case.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    callbacks = managerCallbacks[oldFullName] || [];
                    existingCallbacks = managerCallbacks[fullName];

                    <span class="hljs-keyword">if</span> (fullName !== oldFullName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Update the specified object, but only if it is already
in there. In sync environments, it may not be yet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (oldFullName <span class="hljs-keyword">in</span> specified) {
                            <span class="hljs-keyword">delete</span> specified[oldFullName];
                            specified[fullName] = <span class="hljs-literal">true</span>;
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Update managerCallbacks to use the correct normalized name.
If there are already callbacks for the normalized name,
just add to them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (existingCallbacks) {
                            managerCallbacks[fullName] = existingCallbacks.concat(callbacks);
                        } <span class="hljs-keyword">else</span> {
                            managerCallbacks[fullName] = callbacks;
                        }
                        <span class="hljs-keyword">delete</span> managerCallbacks[oldFullName];</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>In each manager callback, update the normalized name in the depArray.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; callbacks.length; j++) {
                            depArray = callbacks[j].depArray;
                            <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; depArray.length; k++) {
                                <span class="hljs-keyword">if</span> (depArray[k] === oldFullName) {
                                    depArray[k] = fullName;
                                }
                            }
                        }
                    }
                }
            }

            <span class="hljs-keyword">delete</span> normalizedWaiting[pluginName];
        }

        <span class="hljs-comment">/*
         * Queues a dependency for checking after the loader is out of a
         * "paused" state, for example while a script file is being loaded
         * in the browser, where it may have many modules defined in it.
         *
         * depName will be fully qualified, no relative . or .. path.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queueDependency</span>(<span class="hljs-params">dep</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Make sure to load any plugin and associate the dependency
with that plugin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> prefix = dep.prefix,
                fullName = dep.fullName;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Do not bother if the depName is already in transit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (specified[fullName] || fullName <span class="hljs-keyword">in</span> defined) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (prefix &amp;&amp; !plugins[prefix]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Queue up loading of the dependency, track it
via context.plugins. Mark it as a plugin so
that the build system will know to treat it
special.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                plugins[prefix] = <span class="hljs-literal">undefined</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Remember this dep that needs to have normaliztion done
after the plugin loads.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                (normalizedWaiting[prefix] || (normalizedWaiting[prefix] = []))
                    .push(dep);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Register an action to do once the plugin loads, to update
all managerCallbacks to use a properly normalized module
name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                (managerCallbacks[prefix] ||
                (managerCallbacks[prefix] = [])).push({
                    <span class="hljs-attr">onDep</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, value</span>) </span>{
                        <span class="hljs-keyword">if</span> (name === prefix) {
                            updateNormalizedNames(prefix);
                        }
                    }
                });

                queueDependency(makeModuleMap(prefix));
            }

            context.paused.push(dep);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execManager</span>(<span class="hljs-params">manager</span>) </span>{
            <span class="hljs-keyword">var</span> i, ret, waitingCallbacks,
                cb = manager.callback,
                fullName = manager.fullName,
                args = [],
                ary = manager.depArray;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Call the callback to define the module, if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (cb &amp;&amp; isFunction(cb)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Pull out the defined dependencies and pass the ordered
values to the callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (ary) {
                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ary.length; i++) {
                        args.push(manager.deps[ary[i]]);
                    }
                }

                ret = req.execCb(fullName, manager.callback, args);

                <span class="hljs-keyword">if</span> (fullName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>If using exports and the function did not return a value,
and the &quot;module&quot; object for this definition function did not
define an exported value, then use the exports object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (manager.usingExports &amp;&amp; ret === <span class="hljs-literal">undefined</span> &amp;&amp; (!manager.cjsModule || !(<span class="hljs-string">"exports"</span> <span class="hljs-keyword">in</span> manager.cjsModule))) {
                        ret = defined[fullName];
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> (manager.cjsModule &amp;&amp; <span class="hljs-string">"exports"</span> <span class="hljs-keyword">in</span> manager.cjsModule) {
                            ret = defined[fullName] = manager.cjsModule.exports;
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">if</span> (fullName <span class="hljs-keyword">in</span> defined &amp;&amp; !manager.usingExports) {
                                <span class="hljs-keyword">return</span> req.onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(fullName + <span class="hljs-string">" has already been defined"</span>));
                            }
                            defined[fullName] = ret;
                        }
                    }
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fullName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>May just be an object definition for the module. Only
worry about defining if have a module name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                ret = defined[fullName] = cb;
            }

            <span class="hljs-keyword">if</span> (fullName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If anything was waiting for this module to be defined,
notify them now.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                waitingCallbacks = managerCallbacks[fullName];
                <span class="hljs-keyword">if</span> (waitingCallbacks) {
                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; waitingCallbacks.length; i++) {
                        waitingCallbacks[i].onDep(fullName, ret);
                    }
                    <span class="hljs-keyword">delete</span> managerCallbacks[fullName];
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Clean up waiting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (waiting[manager.waitId]) {
                <span class="hljs-keyword">delete</span> waiting[manager.waitId];
                manager.isDone = <span class="hljs-literal">true</span>;
                context.waitCount -= <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (context.waitCount === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Clear the wait array used for cycles.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    waitAry = [];
                }
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params">inName, depArray, callback, relModuleMap</span>) </span>{
            <span class="hljs-keyword">var</span> moduleMap = makeModuleMap(inName, relModuleMap),
                name = moduleMap.name,
                fullName = moduleMap.fullName,
                uniques = {},
                manager = {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Use a wait ID because some entries are anon
async require calls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    waitId: name || reqWaitIdPrefix + (waitIdCounter++),
                    <span class="hljs-attr">depCount</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">depMax</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">prefix</span>: moduleMap.prefix,
                    <span class="hljs-attr">name</span>: name,
                    <span class="hljs-attr">fullName</span>: fullName,
                    <span class="hljs-attr">deps</span>: {},
                    <span class="hljs-attr">depArray</span>: depArray,
                    <span class="hljs-attr">callback</span>: callback,
                    <span class="hljs-attr">onDep</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">depName, value</span>) </span>{
                        <span class="hljs-keyword">if</span> (!(depName <span class="hljs-keyword">in</span> manager.deps)) {
                            manager.deps[depName] = value;
                            manager.depCount += <span class="hljs-number">1</span>;
                            <span class="hljs-keyword">if</span> (manager.depCount === manager.depMax) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>All done, execute!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                execManager(manager);
                            }
                        }
                    }
                },
                i, depArg, depName, cjsMod;

            <span class="hljs-keyword">if</span> (fullName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>If module already defined for context, or already loaded,
then leave.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (fullName <span class="hljs-keyword">in</span> defined || loaded[fullName] === <span class="hljs-literal">true</span>) {
                    <span class="hljs-keyword">return</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Set specified/loaded here for modules that are also loaded
as part of a layer, where onScriptLoad is not fired
for those cases. Do this after the inline define and
dependency tracing is done.
Also check if auto-registry of jQuery needs to be skipped.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                specified[fullName] = <span class="hljs-literal">true</span>;
                loaded[fullName] = <span class="hljs-literal">true</span>;
                context.jQueryDef = (fullName === <span class="hljs-string">"jquery"</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Add the dependencies to the deps field, and register for callbacks
on the dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; depArray.length; i++) {
                depArg = depArray[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>There could be cases like in IE, where a trailing comma will
introduce a null dependency, so only treat a real dependency
value as a dependency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (depArg) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Split the dependency name into plugin and name parts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    depArg = makeModuleMap(depArg, (name ? moduleMap : relModuleMap));
                    depName = depArg.fullName;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Fix the name in depArray to be just the name, since
that is how it will be called back later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    depArray[i] = depName;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Fast path CommonJS standard dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"require"</span>) {
                        manager.deps[depName] = makeRequire(moduleMap);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"exports"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>CommonJS module spec 1.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        manager.deps[depName] = defined[fullName] = {};
                        manager.usingExports = <span class="hljs-literal">true</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"module"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>CommonJS module spec 1.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        manager.cjsModule = cjsMod = manager.deps[depName] = {
                            <span class="hljs-attr">id</span>: name,
                            <span class="hljs-attr">uri</span>: name ? context.nameToUrl(name, <span class="hljs-literal">null</span>, relModuleMap) : <span class="hljs-literal">undefined</span>
                        };
                        cjsMod.setExports = makeSetExports(cjsMod);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depName <span class="hljs-keyword">in</span> defined &amp;&amp; !(depName <span class="hljs-keyword">in</span> waiting)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Module already defined, no need to wait for it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        manager.deps[depName] = defined[depName];
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!uniques[depName]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>A dynamic dependency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        manager.depMax += <span class="hljs-number">1</span>;

                        queueDependency(depArg);</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Register to get notification when dependency loads.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        (managerCallbacks[depName] ||
                        (managerCallbacks[depName] = [])).push(manager);

                        uniques[depName] = <span class="hljs-literal">true</span>;
                    }
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Do not bother tracking the manager if it is all done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (manager.depCount === manager.depMax) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>All done, execute!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                execManager(manager);
            } <span class="hljs-keyword">else</span> {
                waiting[manager.waitId] = manager;
                waitAry.push(manager);
                context.waitCount += <span class="hljs-number">1</span>;
            }
        }

        <span class="hljs-comment">/**
         * Convenience method to call main for a require.def call that was put on
         * hold in the defQueue.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callDefMain</span>(<span class="hljs-params">args</span>) </span>{
            main.apply(<span class="hljs-literal">null</span>, args);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Mark the module loaded. Must do it here in addition
to doing it in require.def in case a script does
not call require.def</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            loaded[args[<span class="hljs-number">0</span>]] = <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">/**
         * As of jQuery 1.4.3, it supports a readyWait property that will hold off
         * calling jQuery ready callbacks until all scripts are loaded. Be sure
         * to track it if readyWait is available. Also, since jQuery 1.4.3 does
         * not register as a module, need to do some global inference checking.
         * Even if it does register as a module, not guaranteed to be the precise
         * name of the global. If a jQuery is tracked for this context, then go
         * ahead and register it as a module too, if not already in process.
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jQueryCheck</span>(<span class="hljs-params">jqCandidate</span>) </span>{
            <span class="hljs-keyword">if</span> (!context.jQuery) {
                <span class="hljs-keyword">var</span> $ = jqCandidate || (<span class="hljs-keyword">typeof</span> jQuery !== <span class="hljs-string">"undefined"</span> ? jQuery : <span class="hljs-literal">null</span>);
                <span class="hljs-keyword">if</span> ($ &amp;&amp; <span class="hljs-string">"readyWait"</span> <span class="hljs-keyword">in</span> $) {
                    context.jQuery = $;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Manually create a &quot;jquery&quot; module entry if not one already
or in process.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    callDefMain([<span class="hljs-string">"jquery"</span>, [], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> jQuery;
                    }]);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Increment jQuery readyWait if ncecessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (context.scriptCount) {
                        $.readyWait += <span class="hljs-number">1</span>;
                        context.jQueryIncremented = <span class="hljs-literal">true</span>;
                    }
                }
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forceExec</span>(<span class="hljs-params">manager, traced</span>) </span>{
            <span class="hljs-keyword">if</span> (manager.isDone) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }

            <span class="hljs-keyword">var</span> fullName = manager.fullName,
                depArray = manager.depArray,
                depName, i;
            <span class="hljs-keyword">if</span> (fullName) {
                <span class="hljs-keyword">if</span> (traced[fullName]) {
                    <span class="hljs-keyword">return</span> defined[fullName];
                }

                traced[fullName] = <span class="hljs-literal">true</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>forceExec all of its dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; depArray.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Some array members may be null, like if a trailing comma
IE, so do the explicit [i] access and check if it has a value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                depName = depArray[i];
                <span class="hljs-keyword">if</span> (depName) {
                    <span class="hljs-keyword">if</span> (!manager.deps[depName] &amp;&amp; waiting[depName]) {
                        manager.onDep(depName, forceExec(waiting[depName], traced));
                    }
                }
            }

            <span class="hljs-keyword">return</span> fullName ? defined[fullName] : <span class="hljs-literal">undefined</span>;
        }

        <span class="hljs-comment">/**
         * Checks if all modules for a context are loaded, and if so, evaluates the
         * new ones in right dependency order.
         *
         * <span class="hljs-doctag">@private</span>
         */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLoaded</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> waitInterval = config.waitSeconds * <span class="hljs-number">1000</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>It is possible to disable the wait interval by using waitSeconds of 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                expired = waitInterval &amp;&amp; (context.startTime + waitInterval) &lt; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(),
                noLoads = <span class="hljs-string">""</span>, hasLoadedProp = <span class="hljs-literal">false</span>, stillLoading = <span class="hljs-literal">false</span>, prop,
                err, manager;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>If there are items still in the paused queue processing wait.
This is particularly important in the sync case where each paused
item is processed right away but there may be more waiting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (context.pausedCount &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Determine if priority loading is done. If so clear the priority. If
not, then do not check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (config.priorityWait) {
                <span class="hljs-keyword">if</span> (isPriorityDone()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Call resume, since it could have
some waiting dependencies to trace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    resume();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>See if anything is still in flight.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> loaded) {
                <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty)) {
                    hasLoadedProp = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">if</span> (!loaded[prop]) {
                        <span class="hljs-keyword">if</span> (expired) {
                            noLoads += prop + <span class="hljs-string">" "</span>;
                        } <span class="hljs-keyword">else</span> {
                            stillLoading = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Check for exit conditions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!hasLoadedProp &amp;&amp; !context.waitCount) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>If the loaded object had no items, then the rest of
the work below does not need to be done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }
            <span class="hljs-keyword">if</span> (expired &amp;&amp; noLoads) {</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>If wait time expired, throw error of unloaded modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"require.js load timeout for modules: "</span> + noLoads);
                err.requireType = <span class="hljs-string">"timeout"</span>;
                err.requireModules = noLoads;
                <span class="hljs-keyword">return</span> req.onError(err);
            }
            <span class="hljs-keyword">if</span> (stillLoading || context.scriptCount) {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Something is still waiting to load. Wait for it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (isBrowser || isWebWorker) {
                    setTimeout(checkLoaded, <span class="hljs-number">50</span>);
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>If still have items in the waiting cue, but all modules have
been loaded, then it means there are some circular dependencies
that need to be broken.
However, as a waiting thing is fired, then it can add items to
the waiting cue, and those items should not be fired yet, so
make sure to redo the checkLoaded call after breaking a single
cycle, if nothing else loaded then this logic will pick it up
again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (context.waitCount) {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Cycle through the waitAry, and call items in sequence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (manager = waitAry[i]); i++) {
                    forceExec(manager, {});
                }

                checkLoaded();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Check for DOM ready, and nothing is waiting across contexts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            req.checkReadyState();

            <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callPlugin</span>(<span class="hljs-params">pluginName, dep</span>) </span>{
            <span class="hljs-keyword">var</span> name = dep.name,
                fullName = dep.fullName,
                load;</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Do not bother if plugin is already defined or being loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (fullName <span class="hljs-keyword">in</span> defined || fullName <span class="hljs-keyword">in</span> loaded) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (!plugins[pluginName]) {
                plugins[pluginName] = defined[pluginName];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Only set loaded to false for tracking if it has not already been set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!loaded[fullName]) {
                loaded[fullName] = <span class="hljs-literal">false</span>;
            }

            load = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ret</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Allow the build process to register plugin-loaded dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.onPluginLoad) {
                    <span class="hljs-built_in">require</span>.onPluginLoad(context, pluginName, name, ret);
                }

                execManager({
                    <span class="hljs-attr">prefix</span>: dep.prefix,
                    <span class="hljs-attr">name</span>: dep.name,
                    <span class="hljs-attr">fullName</span>: dep.fullName,
                    <span class="hljs-attr">callback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> ret;
                    }
                });
                loaded[fullName] = <span class="hljs-literal">true</span>;
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Allow plugins to load other code without having to know the
context or how to &quot;complete&quot; the load.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            load.fromText = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName, text</span>) </span>{
                <span class="hljs-comment">/*jslint evil: true */</span>
                <span class="hljs-keyword">var</span> hasInteractive = useInteractive;</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Indicate a the module is in process of loading.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                context.loaded[moduleName] = <span class="hljs-literal">false</span>;
                context.scriptCount += <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Turn off interactive script matching for IE for any define
calls in the text, then turn it back on at the end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (hasInteractive) {
                    useInteractive = <span class="hljs-literal">false</span>;
                }
                <span class="hljs-built_in">eval</span>(text);
                <span class="hljs-keyword">if</span> (hasInteractive) {
                    useInteractive = <span class="hljs-literal">true</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Support anonymous modules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                context.completeLoad(moduleName);
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Use parentName here since the plugin&#39;s name is not reliable,
could be some weird string with no path that actually wants to
reference the parentName&#39;s path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            plugins[pluginName].load(name, makeRequire(dep.parentMap, <span class="hljs-literal">true</span>), load, config);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadPaused</span>(<span class="hljs-params">dep</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Renormalize dependency if its name was waiting on a plugin
to load, which as since loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (dep.prefix &amp;&amp; dep.name.indexOf(<span class="hljs-string">'__$p'</span>) === <span class="hljs-number">0</span> &amp;&amp; defined[dep.prefix]) {
                dep = makeModuleMap(dep.originalName, dep.parentMap);
            }

            <span class="hljs-keyword">var</span> pluginName = dep.prefix,
                fullName = dep.fullName;</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Do not bother if the dependency has already been specified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (specified[fullName] || loaded[fullName]) {
                <span class="hljs-keyword">return</span>;
            } <span class="hljs-keyword">else</span> {
                specified[fullName] = <span class="hljs-literal">true</span>;
            }

            <span class="hljs-keyword">if</span> (pluginName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>If plugin not loaded, wait for it.
set up callback list. if no list, then register
managerCallback for that plugin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (defined[pluginName]) {
                    callPlugin(pluginName, dep);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (!pluginsQueue[pluginName]) {
                        pluginsQueue[pluginName] = [];
                        (managerCallbacks[pluginName] ||
                        (managerCallbacks[pluginName] = [])).push({
                            <span class="hljs-attr">onDep</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, value</span>) </span>{
                                <span class="hljs-keyword">if</span> (name === pluginName) {
                                    <span class="hljs-keyword">var</span> i, oldModuleMap, ary = pluginsQueue[pluginName];</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Now update all queued plugin actions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; ary.length; i++) {
                                        oldModuleMap = ary[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Update the moduleMap since the
module name may be normalized
differently now.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        callPlugin(pluginName,
                                                   makeModuleMap(oldModuleMap.originalName, oldModuleMap.parentMap));
                                    }
                                    <span class="hljs-keyword">delete</span> pluginsQueue[pluginName];
                                }
                            }
                        });
                    }
                    pluginsQueue[pluginName].push(dep);
                }
            } <span class="hljs-keyword">else</span> {
                req.load(context, fullName, dep.url);
            }
        }

        <span class="hljs-comment">/**
         * Resumes tracing of dependencies and then checks if everything is loaded.
         */</span>
        resume = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> args, i, p;

            resumeDepth += <span class="hljs-number">1</span>;

            <span class="hljs-keyword">if</span> (context.scriptCount &lt;= <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Synchronous envs will push the number below zero with the
decrement above, be sure to set it back to zero for good measure.
require() calls that also do not end up loading scripts could
push the number negative too.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                context.scriptCount = <span class="hljs-number">0</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Make sure any remaining defQueue items get properly processed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">while</span> (defQueue.length) {
                args = defQueue.shift();
                <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span> req.onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Mismatched anonymous require.def modules'</span>));
                } <span class="hljs-keyword">else</span> {
                    callDefMain(args);
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Skip the resume of paused dependencies
if current context is in priority wait.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!config.priorityWait || isPriorityDone()) {
                <span class="hljs-keyword">while</span> (context.paused.length) {
                    p = context.paused;
                    context.pausedCount += p.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Reset paused list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    context.paused = [];

                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (args = p[i]); i++) {
                        loadPaused(args);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Move the start time for timeout forward.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    context.startTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();
                    context.pausedCount -= p.length;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Only check if loaded when resume depth is 1. It is likely that
it is only greater than 1 in sync environments where a factory
function also then calls the callback-style require. In those
cases, the checkLoaded should not occur until the resume
depth is back at the top level.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (resumeDepth === <span class="hljs-number">1</span>) {
                checkLoaded();
            }

            resumeDepth -= <span class="hljs-number">1</span>;

            <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Define the context object. Many of these fields are on here
just to make debugging easier.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        context = {
            <span class="hljs-attr">contextName</span>: contextName,
            <span class="hljs-attr">config</span>: config,
            <span class="hljs-attr">defQueue</span>: defQueue,
            <span class="hljs-attr">waiting</span>: waiting,
            <span class="hljs-attr">waitCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">specified</span>: specified,
            <span class="hljs-attr">loaded</span>: loaded,
            <span class="hljs-attr">urlMap</span>: urlMap,
            <span class="hljs-attr">scriptCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">urlFetched</span>: {},
            <span class="hljs-attr">defined</span>: defined,
            <span class="hljs-attr">paused</span>: [],
            <span class="hljs-attr">pausedCount</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">plugins</span>: plugins,
            <span class="hljs-attr">managerCallbacks</span>: managerCallbacks,
            <span class="hljs-attr">makeModuleMap</span>: makeModuleMap,
            <span class="hljs-attr">normalize</span>: normalize,
            <span class="hljs-comment">/**
             * Set a configuration for the context.
             * <span class="hljs-doctag">@param <span class="hljs-type">{Object}</span> </span>cfg config object to integrate.
             */</span>
            <span class="hljs-attr">configure</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cfg</span>) </span>{
                <span class="hljs-keyword">var</span> paths, prop, packages, pkgs, packagePaths, requireWait;</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Make sure the baseUrl ends in a slash.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cfg.baseUrl) {
                    <span class="hljs-keyword">if</span> (cfg.baseUrl.charAt(cfg.baseUrl.length - <span class="hljs-number">1</span>) !== <span class="hljs-string">"/"</span>) {
                        cfg.baseUrl += <span class="hljs-string">"/"</span>;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Save off the paths and packages since they require special processing,
they are additive.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                paths = config.paths;
                packages = config.packages;
                pkgs = config.pkgs;</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Mix in the config values, favoring the new values over
existing ones in context.config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                mixin(config, cfg, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Adjust paths if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cfg.paths) {
                    <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> cfg.paths) {
                        <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty)) {
                            paths[prop] = cfg.paths[prop];
                        }
                    }
                    config.paths = paths;
                }

                packagePaths = cfg.packagePaths;
                <span class="hljs-keyword">if</span> (packagePaths || cfg.packages) {</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Convert packagePaths into a packages config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (packagePaths) {
                        <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> packagePaths) {
                            <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty)) {
                                configurePackageDir(pkgs, packagePaths[prop], prop);
                            }
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Adjust packages if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (cfg.packages) {
                        configurePackageDir(pkgs, cfg.packages);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Done with modifications, assing packages back to context config</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    config.pkgs = pkgs;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>If priority loading is in effect, trigger the loads now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cfg.priority) {</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Hold on to requireWait value, and reset it after done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    requireWait = context.requireWait;</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Allow tracing some require calls to allow the fetching
of the priority config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    context.requireWait = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>But first, call resume to register any defined modules that may
be in a data-main built file before the priority config
call. Also grab any waiting define calls for this context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    context.takeGlobalQueue();
                    resume();

                    context.require(cfg.priority);</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Trigger a resume right away, for the case when
the script with the priority load is done as part
of a data-main call. In that case the normal resume
call will not happen because the scriptCount will be
at 1, since the script for data-main is being processed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    resume();</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Restore previous state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    context.requireWait = requireWait;
                    config.priorityWait = cfg.priority;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>If a deps array or a config callback is specified, then call
require with those args. This is useful when require is defined as a
config object before require.js is loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cfg.deps || cfg.callback) {
                    context.require(cfg.deps || [], cfg.callback);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Set up ready callback, if asked. Useful when require is defined as a
config object before require.js is loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cfg.ready) {
                    req.ready(cfg.ready);
                }
            },

            <span class="hljs-attr">isDefined</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName, relModuleMap</span>) </span>{
                <span class="hljs-keyword">return</span> makeModuleMap(moduleName, relModuleMap).fullName <span class="hljs-keyword">in</span> defined;
            },

            <span class="hljs-attr">require</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">deps, callback, relModuleMap</span>) </span>{
                <span class="hljs-keyword">var</span> moduleName, ret, moduleMap;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> deps === <span class="hljs-string">"string"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Synchronous access to one module. If require.get is
available (as in the Node adapter), prefer that.
In this case deps is the moduleName and callback is
the relModuleMap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (req.get) {
                        <span class="hljs-keyword">return</span> req.get(context, deps, callback);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Just return the module wanted. In this scenario, the
second arg (if passed) is just the relModuleMap.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    moduleName = deps;
                    relModuleMap = callback;</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Normalize module name, if it contains . or ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    moduleMap = makeModuleMap(moduleName, relModuleMap);

                    ret = defined[moduleMap.fullName];
                    <span class="hljs-keyword">if</span> (ret === <span class="hljs-literal">undefined</span>) {
                        <span class="hljs-keyword">return</span> req.onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"require: module name '"</span> +
                                    moduleMap.fullName +
                                    <span class="hljs-string">"' has not been loaded yet for context: "</span> +
                                    contextName));
                    }
                    <span class="hljs-keyword">return</span> ret;
                }

                main(<span class="hljs-literal">null</span>, deps, callback, relModuleMap);</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>If the require call does not trigger anything new to load,
then resume the dependency processing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!context.requireWait) {
                    <span class="hljs-keyword">while</span> (!context.scriptCount &amp;&amp; context.paused.length) {
                        resume();
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            },

            <span class="hljs-comment">/**
             * Internal method to transfer globalQueue items to this context's
             * defQueue.
             */</span>
            <span class="hljs-attr">takeGlobalQueue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Push all the globalDefQueue items into the context&#39;s defQueue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (globalDefQueue.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Array splice in the values since the context code has a
local var ref to defQueue, so cannot just reassign the one
on context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    apsp.apply(context.defQueue,
                               [context.defQueue.length - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>].concat(globalDefQueue));
                    globalDefQueue = [];
                }
            },

            <span class="hljs-comment">/**
             * Internal method used by environment adapters to complete a load event.
             * A load event could be a script load or just a load pass from a synchronous
             * load call.
             * <span class="hljs-doctag">@param <span class="hljs-type">{String}</span> </span>moduleName the name of the module to potentially complete.
             */</span>
            <span class="hljs-attr">completeLoad</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName</span>) </span>{
                <span class="hljs-keyword">var</span> args;

                context.takeGlobalQueue();

                <span class="hljs-keyword">while</span> (defQueue.length) {
                    args = defQueue.shift();

                    <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] === <span class="hljs-literal">null</span>) {
                        args[<span class="hljs-number">0</span>] = moduleName;
                        <span class="hljs-keyword">break</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args[<span class="hljs-number">0</span>] === moduleName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Found matching require.def call for this script!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">break</span>;
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Some other named require.def call, most likely the result
of a build layer that included many require.def calls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        callDefMain(args);
                        args = <span class="hljs-literal">null</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (args) {
                    callDefMain(args);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>A script that does not call define(), so just simulate
the call for it. Special exception for jQuery dynamic load.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    callDefMain([moduleName, [],
                                moduleName === <span class="hljs-string">"jquery"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> jQuery !== <span class="hljs-string">"undefined"</span> ?
                                <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                    <span class="hljs-keyword">return</span> jQuery;
                                } : <span class="hljs-literal">null</span>]);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Mark the script as loaded. Note that this can be different from a
moduleName that maps to a require.def call. This line is important
for traditional browser scripts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                loaded[moduleName] = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>If a global jQuery is defined, check for it. Need to do it here
instead of main() since stock jQuery does not register as
a module via define.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                jQueryCheck();</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Doing this scriptCount decrement branching because sync envs
need to decrement after resume, otherwise it looks like
loading is complete after the first dependency is fetched.
For browsers, it works fine to decrement after, but it means
the checkLoaded setTimeout 50 ms cost is taken. To avoid
that cost, decrement beforehand.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (req.isAsync) {
                    context.scriptCount -= <span class="hljs-number">1</span>;
                }
                resume();
                <span class="hljs-keyword">if</span> (!req.isAsync) {
                    context.scriptCount -= <span class="hljs-number">1</span>;
                }
            },

            <span class="hljs-comment">/**
             * Converts a module name + .extension into an URL path.
             * *Requires* the use of a module name. It does not support using
             * plain URLs like nameToUrl.
             */</span>
            <span class="hljs-attr">toUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moduleNamePlusExt, relModuleMap</span>) </span>{
                <span class="hljs-keyword">var</span> index = moduleNamePlusExt.lastIndexOf(<span class="hljs-string">"."</span>),
                    ext = <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
                    ext = moduleNamePlusExt.substring(index, moduleNamePlusExt.length);
                    moduleNamePlusExt = moduleNamePlusExt.substring(<span class="hljs-number">0</span>, index);
                }

                <span class="hljs-keyword">return</span> context.nameToUrl(moduleNamePlusExt, ext, relModuleMap);
            },

            <span class="hljs-comment">/**
             * Converts a module name to a file path. Supports cases where
             * moduleName may actually be just an URL.
             */</span>
            <span class="hljs-attr">nameToUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName, ext, relModuleMap</span>) </span>{
                <span class="hljs-keyword">var</span> paths, pkgs, pkg, pkgPath, syms, i, parentModule, url,
                    config = context.config;

                <span class="hljs-keyword">if</span> (moduleName.indexOf(<span class="hljs-string">"./"</span>) === <span class="hljs-number">0</span> || moduleName.indexOf(<span class="hljs-string">"../"</span>) === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>A relative ID, just map it relative to relModuleMap&#39;s url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    syms = relModuleMap &amp;&amp; relModuleMap.url ? relModuleMap.url.split(<span class="hljs-string">'/'</span>) : [];</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Pop off the file name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (syms.length) {
                        syms.pop();
                    }
                    syms = syms.concat(moduleName.split(<span class="hljs-string">'/'</span>));
                    trimDots(syms);
                    url = syms.join(<span class="hljs-string">'/'</span>) +
                          (ext ? ext :
                          (req.jsExtRegExp.test(moduleName) ? <span class="hljs-string">""</span> : <span class="hljs-string">".js"</span>));
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Normalize module name if have a base relative module name to work from.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    moduleName = normalize(moduleName, relModuleMap);</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>If a colon is in the URL, it indicates a protocol is used and it is just
an URL to a file, or if it starts with a slash or ends with .js, it is just a plain file.
The slash is important for protocol-less URLs as well as full paths.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (req.jsExtRegExp.test(moduleName)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Just a plain path, not module name lookup, so just return it.
Add extension if it is included. This is a bit wonky, only non-.js things pass
an extension, this method probably needs to be reworked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        url = moduleName + (ext ? ext : <span class="hljs-string">""</span>);
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>A module that needs to be converted to a path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        paths = config.paths;
                        pkgs = config.pkgs;

                        syms = moduleName.split(<span class="hljs-string">"/"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>For each module name segment, see if there is a path
registered for it. Start with most specific name
and work up from it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">for</span> (i = syms.length; i &gt; <span class="hljs-number">0</span>; i--) {
                            parentModule = syms.slice(<span class="hljs-number">0</span>, i).join(<span class="hljs-string">"/"</span>);
                            <span class="hljs-keyword">if</span> (paths[parentModule]) {
                                syms.splice(<span class="hljs-number">0</span>, i, paths[parentModule]);
                                <span class="hljs-keyword">break</span>;
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((pkg = pkgs[parentModule])) {</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>If module name is just the package name, then looking
for the main module.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (moduleName === pkg.name) {
                                    pkgPath = pkg.location + <span class="hljs-string">'/'</span> + pkg.main;
                                } <span class="hljs-keyword">else</span> {
                                    pkgPath = pkg.location + <span class="hljs-string">'/'</span> + pkg.lib;
                                }
                                syms.splice(<span class="hljs-number">0</span>, i, pkgPath);
                                <span class="hljs-keyword">break</span>;
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Join the path parts together, then figure out if baseUrl is needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        url = syms.join(<span class="hljs-string">"/"</span>) + (ext || <span class="hljs-string">".js"</span>);
                        url = (url.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">'/'</span> || url.match(<span class="hljs-regexp">/^\w+:/</span>) ? <span class="hljs-string">""</span> : config.baseUrl) + url;
                    }
                }

                <span class="hljs-keyword">return</span> config.urlArgs ? url +
                                        ((url.indexOf(<span class="hljs-string">'?'</span>) === <span class="hljs-number">-1</span> ? <span class="hljs-string">'?'</span> : <span class="hljs-string">'&amp;'</span>) +
                                         config.urlArgs) : url;
            }
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Make these visible on the context so can be called at the very
end of the file to bootstrap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        context.jQueryCheck = jQueryCheck;
        context.resume = resume;

        <span class="hljs-keyword">return</span> context;
    }

    <span class="hljs-comment">/**
     * Main entry point.
     *
     * If the only argument to require is a string, then the module that
     * is represented by that string is fetched for the appropriate context.
     *
     * If the first argument is an array, then it will be treated as an array
     * of dependency string names to fetch. An optional function callback can
     * be specified to execute when all of those dependencies are available.
     *
     * Make a local req variable to help Caja compliance (it assumes things
     * on a require that are not standardized), and to give a short
     * name for minification/local scope use.
     */</span>
    req = <span class="hljs-built_in">require</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">deps, callback</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Find the right context, use default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> contextName = defContextName,
            context, config;</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Determine if have config object in the call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!isArray(deps) &amp;&amp; <span class="hljs-keyword">typeof</span> deps !== <span class="hljs-string">"string"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>deps is a config object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            config = deps;
            <span class="hljs-keyword">if</span> (isArray(callback)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Adjust args if there are dependencies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                deps = callback;
                callback = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>];
            } <span class="hljs-keyword">else</span> {
                deps = [];
            }
        }

        <span class="hljs-keyword">if</span> (config &amp;&amp; config.context) {
            contextName = config.context;
        }

        context = contexts[contextName] ||
                  (contexts[contextName] = newContext(contextName));

        <span class="hljs-keyword">if</span> (config) {
            context.configure(config);
        }

        <span class="hljs-keyword">return</span> context.require(deps, callback);
    };

    req.version = version;
    req.isArray = isArray;
    req.isFunction = isFunction;
    req.mixin = mixin;</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Used to filter out dependencies that are already paths.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    req.jsExtRegExp = <span class="hljs-regexp">/^\/|:|\?|\.js$/</span>;
    s = req.s = {
        <span class="hljs-attr">contexts</span>: contexts,</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Stores a list of URLs that should not get async script tag treatment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        skipAsync: {},
        <span class="hljs-attr">isPageLoaded</span>: !isBrowser,
        <span class="hljs-attr">readyCalls</span>: []
    };

    req.isAsync = req.isBrowser = isBrowser;
    <span class="hljs-keyword">if</span> (isBrowser) {
        head = s.head = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"head"</span>)[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>If BASE tag is in play, using appendChild is a problem for IE6.
When that browser dies, this can be removed. Details in this jQuery bug:
<a href="http://dev.jquery.com/ticket/2709">http://dev.jquery.com/ticket/2709</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        baseElement = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"base"</span>)[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (baseElement) {
            head = s.head = baseElement.parentNode;
        }
    }

    <span class="hljs-comment">/**
     * Any errors that require explicitly generates will be passed to this
     * function. Intercept/override it if you want custom error handling.
     * <span class="hljs-doctag">@param <span class="hljs-type">{Error}</span> </span>err the error object.
     */</span>
    req.onError = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">throw</span> err;
    };

    <span class="hljs-comment">/**
     * Does the request to load a module for the browser case.
     * Make this a separate function to allow other environments
     * to override it.
     *
     * @param {Object} context the require context to find state.
     * @param {String} moduleName the name of the module.
     * @param {Object} url the URL to the module.
     */</span>
    req.load = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context, moduleName, url</span>) </span>{
        <span class="hljs-keyword">var</span> contextName = context.contextName,
            urlFetched = context.urlFetched,
            loaded = context.loaded;
        isDone = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Only set loaded to false for tracking if it has not already been set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!loaded[moduleName]) {
            loaded[moduleName] = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (!urlFetched[url]) {
            context.scriptCount += <span class="hljs-number">1</span>;
            req.attach(url, contextName, moduleName);
            urlFetched[url] = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>If tracking a jQuery, then make sure its readyWait
is incremented to prevent its ready callbacks from
triggering too soon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (context.jQuery &amp;&amp; !context.jQueryIncremented) {
                context.jQuery.readyWait += <span class="hljs-number">1</span>;
                context.jQueryIncremented = <span class="hljs-literal">true</span>;
            }
        }
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInteractiveScript</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> scripts, i, script;
        <span class="hljs-keyword">if</span> (interactiveScript &amp;&amp; interactiveScript.readyState === <span class="hljs-string">'interactive'</span>) {
            <span class="hljs-keyword">return</span> interactiveScript;
        }

        scripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'script'</span>);
        <span class="hljs-keyword">for</span> (i = scripts.length - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">-1</span> &amp;&amp; (script = scripts[i]); i--) {
            <span class="hljs-keyword">if</span> (script.readyState === <span class="hljs-string">'interactive'</span>) {
                <span class="hljs-keyword">return</span> (interactiveScript = script);
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/**
     * The function that handles definitions of modules. Differs from
     * require() in that a string for the module should be the first argument,
     * and the function to execute after dependencies are loaded should
     * return a value to define the module corresponding to the first argument's
     * name.
     */</span>
    define = req.def = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, deps, callback</span>) </span>{
        <span class="hljs-keyword">var</span> node, context;</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Allow for anonymous functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> name !== <span class="hljs-string">'string'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Adjust args appropriately</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            callback = deps;
            deps = name;
            name = <span class="hljs-literal">null</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>This module may not have dependencies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!req.isArray(deps)) {
            callback = deps;
            deps = [];
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>If no name, and callback is a function, then figure out if it a
CommonJS thing with dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!name &amp;&amp; !deps.length &amp;&amp; req.isFunction(callback)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Remove comments from the callback string,
look for require calls, and pull them into the dependencies,
but only if there are function args.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (callback.length) {
                callback
                    .toString()
                    .replace(commentRegExp, <span class="hljs-string">""</span>)
                    .replace(cjsRequireRegExp, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">match, dep</span>) </span>{
                        deps.push(dep);
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>May be a CommonJS thing even without require calls, but still
could use exports, and such, so always add those as dependencies.
This is a bit wasteful for RequireJS modules that do not need
an exports or module object, but erring on side of safety.
REQUIRES the function to expect the CommonJS variables in the
order listed below.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                deps = [<span class="hljs-string">"require"</span>, <span class="hljs-string">"exports"</span>, <span class="hljs-string">"module"</span>].concat(deps);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>If in IE 6-8 and hit an anonymous define() call, do the interactive
work.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (useInteractive) {
            node = currentlyAddingScript || getInteractiveScript();
            <span class="hljs-keyword">if</span> (!node) {
                <span class="hljs-keyword">return</span> req.onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"ERROR: No matching script interactive for "</span> + callback));
            }
            <span class="hljs-keyword">if</span> (!name) {
                name = node.getAttribute(<span class="hljs-string">"data-requiremodule"</span>);
            }
            context = contexts[node.getAttribute(<span class="hljs-string">"data-requirecontext"</span>)];
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Always save off evaluating the def call until the script onload handler.
This allows multiple modules to be in a file without prematurely
tracing dependencies, and allows for anonymous module support,
where the module name is not known until the script onload event
occurs. If no context, use the global queue, and get it processed
in the onscript load callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        (context ? context.defQueue : globalDefQueue).push([name, deps, callback]);

        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    };

    define.amd = {
        <span class="hljs-attr">multiversion</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">plugins</span>: <span class="hljs-literal">true</span>
    };

    <span class="hljs-comment">/**
     * Executes a module callack function. Broken out as a separate function
     * solely to allow the build system to sequence the files in the built
     * layer in the right sequence.
     *
     * @private
     */</span>
    req.execCb = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, callback, args</span>) </span>{
        <span class="hljs-keyword">return</span> callback.apply(<span class="hljs-literal">null</span>, args);
    };

    <span class="hljs-comment">/**
     * callback for script loads, used to check status of loading.
     *
     * @param {Event} evt the event from the browser for the script
     * that was loaded.
     *
     * @private
     */</span>
    req.onScriptLoad = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Using currentTarget instead of target for Firefox 2.0&#39;s sake. Not
all old browsers will be supported, but this one was easy enough
to support and still makes sense.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> node = evt.currentTarget || evt.srcElement, contextName, moduleName,
            context;

        <span class="hljs-keyword">if</span> (evt.type === <span class="hljs-string">"load"</span> || readyRegExp.test(node.readyState)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Reset interactive script so a script node is not held onto for
to long.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            interactiveScript = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Pull out the name of the module and the context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            contextName = node.getAttribute(<span class="hljs-string">"data-requirecontext"</span>);
            moduleName = node.getAttribute(<span class="hljs-string">"data-requiremodule"</span>);
            context = contexts[contextName];

            contexts[contextName].completeLoad(moduleName);</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Clean up script binding. Favor detachEvent because of IE9
issue, see attachEvent/addEventListener comment elsewhere
in this file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (node.detachEvent &amp;&amp; !isOpera) {</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Probably IE. If not it will throw an error, which will be
useful to know.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                node.detachEvent(<span class="hljs-string">"onreadystatechange"</span>, req.onScriptLoad);
            } <span class="hljs-keyword">else</span> {
                node.removeEventListener(<span class="hljs-string">"load"</span>, req.onScriptLoad, <span class="hljs-literal">false</span>);
            }
        }
    };

    <span class="hljs-comment">/**
     * Attaches the script represented by the URL to the current
     * environment. Right now only supports browser loading,
     * but can be redefined in other environments to do the right thing.
     * @param {String} url the url of the script to attach.
     * @param {String} contextName the name of the context that wants the script.
     * @param {moduleName} the name of the module that is associated with the script.
     * @param {Function} [callback] optional callback, defaults to require.onScriptLoad
     * @param {String} [type] optional type, defaults to text/javascript
     */</span>
    req.attach = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">url, contextName, moduleName, callback, type</span>) </span>{
        <span class="hljs-keyword">var</span> node, loaded, context;
        <span class="hljs-keyword">if</span> (isBrowser) {</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>In the browser so use a script tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            callback = callback || req.onScriptLoad;
            node = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"script"</span>);
            node.type = type || <span class="hljs-string">"text/javascript"</span>;
            node.charset = <span class="hljs-string">"utf-8"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Use async so Gecko does not block on executing the script if something
like a long-polling comet tag is being run first. Gecko likes
to evaluate scripts in DOM order, even for dynamic scripts.
It will fetch them async, but only evaluate the contents in DOM
order, so a long-polling script tag can delay execution of scripts
after it. But telling Gecko we expect async gets us the behavior
we want -- execute it whenever it is finished downloading. Only
Helps Firefox 3.6+
Allow some URLs to not be fetched async. Mostly helps the order!
plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            node.async = !s.skipAsync[url];

            node.setAttribute(<span class="hljs-string">"data-requirecontext"</span>, contextName);
            node.setAttribute(<span class="hljs-string">"data-requiremodule"</span>, moduleName);</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Set up load listener. Test attachEvent first because IE9 has
a subtle issue in its addEventListener and script onload firings
that do not match the behavior of all other browsers with
addEventListener support, which fire the onload event for a
script right after the script execution. See:
<a href="https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution">https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution</a>
UNFORTUNATELY Opera implements attachEvent but does not follow the script
script execution mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (node.attachEvent &amp;&amp; !isOpera) {</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Probably IE. IE (at least 6-8) do not fire
script onload right after executing the script, so
we cannot tie the anonymous require.def call to a name.
However, IE reports the script as being in &quot;interactive&quot;
readyState at the time of the require.def call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                useInteractive = <span class="hljs-literal">true</span>;
                node.attachEvent(<span class="hljs-string">"onreadystatechange"</span>, callback);
            } <span class="hljs-keyword">else</span> {
                node.addEventListener(<span class="hljs-string">"load"</span>, callback, <span class="hljs-literal">false</span>);
            }
            node.src = url;</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>For some cache cases in IE 6-8, the script executes before the end
of the appendChild execution, so to tie an anonymous require.def
call to the module name (which is stored on the node), hold on
to a reference to this node, but clear after the DOM insertion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            currentlyAddingScript = node;
            <span class="hljs-keyword">if</span> (baseElement) {
                head.insertBefore(node, baseElement);
            } <span class="hljs-keyword">else</span> {
                head.appendChild(node);
            }
            currentlyAddingScript = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">return</span> node;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isWebWorker) {</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>In a web worker, use importScripts. This is not a very
efficient use of importScripts, importScripts will block until
its script is downloaded and evaluated. However, if web workers
are in play, the expectation that a build has been done so that
only one script needs to be loaded anyway. This may need to be
reevaluated if other use cases become common.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            context = contexts[contextName];
            loaded = context.loaded;
            loaded[moduleName] = <span class="hljs-literal">false</span>;

            importScripts(url);</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Account for anonymous modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            context.completeLoad(moduleName);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Look for a data-main script attribute, which could also adjust the baseUrl.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isBrowser) {</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Figure out baseUrl. Get it from the script tag with require.js in it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"script"</span>);

        <span class="hljs-keyword">for</span> (i = scripts.length - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">-1</span> &amp;&amp; (script = scripts[i]); i--) {</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Set the &quot;head&quot; where we can append children by
using the script&#39;s parent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!head) {
                head = script.parentNode;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Look for a data-main attribute to set main script for the page
to load. If it is there, the path to data main becomes the
baseUrl, if it is not already set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ((dataMain = script.getAttribute(<span class="hljs-string">'data-main'</span>))) {
                <span class="hljs-keyword">if</span> (!cfg.baseUrl) {</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Pull off the directory of data-main for use as the
baseUrl.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    src = dataMain.split(<span class="hljs-string">'/'</span>);
                    mainScript = src.pop();
                    subPath = src.length ? src.join(<span class="hljs-string">'/'</span>)  + <span class="hljs-string">'/'</span> : <span class="hljs-string">'./'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Set final config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    cfg.baseUrl = subPath;</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Strip off any trailing .js since dataMain is now
like a module name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    dataMain = mainScript.replace(jsSuffixRegExp, <span class="hljs-string">''</span>);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Put the data-main script in the files to load.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                cfg.deps = cfg.deps ? cfg.deps.concat(dataMain) : [dataMain];

                <span class="hljs-keyword">break</span>;
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Set baseUrl based on config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    s.baseUrl = cfg.baseUrl;</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p><strong>**</strong> START page load functionality <strong><strong><strong>****</strong></strong></strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/**
     * Sets the page as loaded and triggers check for all modules loaded.
     */</span>
    req.pageLoaded = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!s.isPageLoaded) {
            s.isPageLoaded = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (scrollIntervalId) {
                clearInterval(scrollIntervalId);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Part of a fix for FF &lt; 3.6 where readyState was not set to
complete so libraries like jQuery that check for readyState
after page load where not getting initialized correctly.
Original approach suggested by Andrea Giammarchi:
<a href="http://webreflection.blogspot.com/2009/11/195-chars-to-help-lazy-loading.html">http://webreflection.blogspot.com/2009/11/195-chars-to-help-lazy-loading.html</a>
see other setReadyState reference for the rest of the fix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (setReadyState) {
                <span class="hljs-built_in">document</span>.readyState = <span class="hljs-string">"complete"</span>;
            }

            req.callReady();
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>See if there is nothing waiting across contexts, and if not, trigger
callReady.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    req.checkReadyState = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> contexts = s.contexts, prop;
        <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> contexts) {
            <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty)) {
                <span class="hljs-keyword">if</span> (contexts[prop].waitCount) {
                    <span class="hljs-keyword">return</span>;
                }
            }
        }
        s.isDone = <span class="hljs-literal">true</span>;
        req.callReady();
    };

    <span class="hljs-comment">/**
     * Internal function that calls back any ready functions. If you are
     * integrating RequireJS with another library without require.ready support,
     * you can define this method to call your page ready code instead.
     */</span>
    req.callReady = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> callbacks = s.readyCalls, i, callback, contexts, context, prop;

        <span class="hljs-keyword">if</span> (s.isPageLoaded &amp;&amp; s.isDone) {
            <span class="hljs-keyword">if</span> (callbacks.length) {
                s.readyCalls = [];
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; (callback = callbacks[i]); i++) {
                    callback();
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>If jQuery with readyWait is being tracked, updated its
readyWait count.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            contexts = s.contexts;
            <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> contexts) {
                <span class="hljs-keyword">if</span> (!(prop <span class="hljs-keyword">in</span> empty)) {
                    context = contexts[prop];
                    <span class="hljs-keyword">if</span> (context.jQueryIncremented) {
                        context.jQuery.ready(<span class="hljs-literal">true</span>);
                        context.jQueryIncremented = <span class="hljs-literal">false</span>;
                    }
                }
            }
        }
    };

    <span class="hljs-comment">/**
     * Registers functions to call when the page is loaded
     */</span>
    req.ready = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
        <span class="hljs-keyword">if</span> (s.isPageLoaded &amp;&amp; s.isDone) {
            callback();
        } <span class="hljs-keyword">else</span> {
            s.readyCalls.push(callback);
        }
        <span class="hljs-keyword">return</span> req;
    };

    <span class="hljs-keyword">if</span> (isBrowser) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.addEventListener) {</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Standards. Hooray! Assumption here that if standards based,
it knows about DOMContentLoaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, req.pageLoaded, <span class="hljs-literal">false</span>);
            <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"load"</span>, req.pageLoaded, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Part of FF &lt; 3.6 readystate fix (see setReadyState refs for more info)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">document</span>.readyState) {
                setReadyState = <span class="hljs-literal">true</span>;
                <span class="hljs-built_in">document</span>.readyState = <span class="hljs-string">"loading"</span>;
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.attachEvent) {
            <span class="hljs-built_in">window</span>.attachEvent(<span class="hljs-string">"onload"</span>, req.pageLoaded);</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>DOMContentLoaded approximation, as found by Diego Perini:
<a href="http://javascript.nwbox.com/IEContentLoaded/">http://javascript.nwbox.com/IEContentLoaded/</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (self === self.top) {
                scrollIntervalId = setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>From this ticket:
<a href="http://bugs.dojotoolkit.org/ticket/11106">http://bugs.dojotoolkit.org/ticket/11106</a>,
In IE HTML Application (HTA), such as in a selenium test,
javascript in the iframe can&#39;t see anything outside
of it, so self===self.top is true, but the iframe is
not the top window and doScroll will be available
before document.body is set. Test document.body
before trying the doScroll trick.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.body) {
                            <span class="hljs-built_in">document</span>.documentElement.doScroll(<span class="hljs-string">"left"</span>);
                            req.pageLoaded();
                        }
                    } <span class="hljs-keyword">catch</span> (e) {}
                }, <span class="hljs-number">30</span>);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Check if document already complete, and if so, just trigger page load
listeners. NOTE: does not work with Firefox before 3.6. To support
those browsers, manually call require.pageLoaded().</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.readyState === <span class="hljs-string">"complete"</span>) {
            req.pageLoaded();
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p><strong>**</strong> END page load functionality <strong><strong><strong>****</strong></strong></strong></p>
<p>Set up default context. If require was a configuration object, use that as base config.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    req(cfg);</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>If modules are built into require.js, then need to make sure dependencies are
traced. Use a setTimeout in the browser world, to allow all the modules to register
themselves. In a non-browser env, assume that modules are not built into require.js,
which seems odd to do on the server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (req.isAsync &amp;&amp; <span class="hljs-keyword">typeof</span> setTimeout !== <span class="hljs-string">"undefined"</span>) {
        ctx = s.contexts[(cfg.context || defContextName)];</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Indicate that the script that includes require() is still loading,
so that require()&#39;d dependencies are not traced until the end of the
file is parsed (approximated via the setTimeout call).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ctx.requireWait = <span class="hljs-literal">true</span>;
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            ctx.requireWait = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Any modules included with the require.js file will be in the
global queue, assign them to this context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ctx.takeGlobalQueue();</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Allow for jQuery to be loaded/already in the page, and if jQuery 1.4.3,
make sure to hold onto it for readyWait triggering.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ctx.jQueryCheck();

            <span class="hljs-keyword">if</span> (!ctx.scriptCount) {
                ctx.resume();
            }
            req.checkReadyState();
        }, <span class="hljs-number">0</span>);
    }
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
