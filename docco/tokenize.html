<!DOCTYPE html>

<html>
<head>
  <title>tokenize.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="asm-llvm.html">
                asm-llvm.js
              </a>
            
              
              <a class="source" href="bcompile.html">
                bcompile.js
              </a>
            
              
              <a class="source" href="binterp.html">
                binterp.js
              </a>
            
              
              <a class="source" href="browsercanvas.html">
                browsercanvas.js
              </a>
            
              
              <a class="source" href="bytecode-table.html">
                bytecode-table.js
              </a>
            
              
              <a class="source" href="canvastest.html">
                canvastest.js
              </a>
            
              
              <a class="source" href="ccanvas.html">
                ccanvas.js
              </a>
            
              
              <a class="source" href="crender-styles.html">
                crender-styles.js
              </a>
            
              
              <a class="source" href="crender.html">
                crender.js
              </a>
            
              
              <a class="source" href="ctiles.html">
                ctiles.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="eventtests.html">
                eventtests.js
              </a>
            
              
              <a class="source" href="extensions.html">
                extensions.js
              </a>
            
              
              <a class="source" href="global-es5.html">
                global-es5.js
              </a>
            
              
              <a class="source" href="global.html">
                global.js
              </a>
            
              
              <a class="source" href="html-escape.html">
                html-escape.js
              </a>
            
              
              <a class="source" href="jcompile.html">
                jcompile.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="nodemain.html">
                nodemain.js
              </a>
            
              
              <a class="source" href="parse.html">
                parse.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="render2.html">
                render2.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="stdlib.html">
                stdlib.js
              </a>
            
              
              <a class="source" href="str-escape.html">
                str-escape.js
              </a>
            
              
              <a class="source" href="tdop.html">
                tdop.js
              </a>
            
              
              <a class="source" href="tests.html">
                tests.js
              </a>
            
              
              <a class="source" href="text.html">
                text.js
              </a>
            
              
              <a class="source" href="tiles.html">
                tiles.js
              </a>
            
              
              <a class="source" href="tokenize.html">
                tokenize.js
              </a>
            
              
              <a class="source" href="top-level.html">
                top-level.js
              </a>
            
              
              <a class="source" href="ts.html">
                ts.js
              </a>
            
              
              <a class="source" href="write-rust-bytecode.html">
                write-rust-bytecode.js
              </a>
            
              
              <a class="source" href="write-rust-ops.html">
                write-rust-ops.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>tokenize.js</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/* 2009-05-17 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>(c) 2006 Douglas Crockford.
Very lightly modified by C. Scott Ananian.</p>
<p>Produce an array of simple token objects from a string.
A simple token object contains these members:</p>
<pre><code>     type: &#39;name&#39;, &#39;string&#39;, &#39;number&#39;, &#39;operator&#39;
     value: string or number value of the token
     from: index of first character of the token
     to: index of the last character + 1</code></pre>
<p>Comments of the // type are ignored.</p>
<p>Operators are by default single characters. Multicharacter
operators can be made by supplying a string of prefix and
suffix characters.
characters. For example,</p>
<pre><code>     &#39;&lt;&gt;+-&amp;&#39;, &#39;=&gt;&amp;:&#39;</code></pre>
<p>will match any of these:</p>
<pre><code>     &lt;=  &gt;&gt;  &gt;&gt;&gt;  &lt;&gt;  &gt;=  +: -: &amp;: &amp;&amp;: &amp;&amp;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>define([<span class="string">'text!tokenize.js'</span>], <span class="function"><span class="keyword">function</span> <span class="title">make_tokenize</span><span class="params">(tokenize_source)</span> {</span> <span class="function"><span class="keyword">function</span> <span class="title">tokenize</span> <span class="params">(_this_, prefix, suffix, DEBUG)</span> {</span>
    <span class="keyword">var</span> c;                      <span class="comment">// The current character.</span>
    <span class="keyword">var</span> from;                   <span class="comment">// The index of the start of the token.</span>
    <span class="keyword">var</span> i = <span class="number">0</span>;                  <span class="comment">// The index of the current character.</span>
    <span class="keyword">var</span> length = _this_.length;
    <span class="keyword">var</span> n;                      <span class="comment">// The number value.</span>
    <span class="keyword">var</span> q;                      <span class="comment">// The quote character.</span>
    <span class="keyword">var</span> str;                    <span class="comment">// The string value.</span>

    <span class="keyword">var</span> result = [];            <span class="comment">// An array to hold the results.</span>

    <span class="keyword">var</span> error = <span class="keyword">function</span>(obj, message, t) {
        t = t || obj;
        t.name = <span class="string">"Syntax Error"</span>;
        <span class="keyword">if</span> (t.from || t.to) { message += <span class="string">' ['</span>+t.from+<span class="string">'-'</span>+t.to+<span class="string">']'</span>; }
        t.message = message;
        Object.Throw(t);
    };

    <span class="keyword">var</span> make = <span class="function"><span class="keyword">function</span> <span class="params">(type, value)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Make a token object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> {
            type: type,
            value: value,
            from: from,
            to: i
        };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Begin tokenization. If the source string is empty, return nothing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (!_this_) {
        <span class="keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>If prefix and suffix strings are not provided, supply defaults.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (<span class="keyword">typeof</span> prefix !== <span class="string">'string'</span>) {
        prefix = <span class="string">'&lt;&gt;+-&amp;'</span>;
    }
    <span class="keyword">if</span> (<span class="keyword">typeof</span> suffix !== <span class="string">'string'</span>) {
        suffix = <span class="string">'=&gt;&amp;:'</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Loop through this text, one character at a time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    c = _this_.charAt(i);
    <span class="keyword">while</span> (c) {
        from = i;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Ignore whitespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> (c &lt;= <span class="string">' '</span>) {
            i += <span class="number">1</span>;
            c = _this_.charAt(i);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span> || c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span> || c === <span class="string">'$'</span> || c === <span class="string">'_'</span>) {
            str = c;
            i += <span class="number">1</span>;
            <span class="keyword">while</span> (<span class="literal">true</span>) {
                c = _this_.charAt(i);
                <span class="keyword">if</span> ((c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) || (c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span>) ||
                        (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) || c === <span class="string">'_'</span> || c === <span class="string">'$'</span>) {
                    str += c;
                    i += <span class="number">1</span>;
                } <span class="keyword">else</span> {
                    <span class="keyword">break</span>;
                }
            }
            result.push(make(<span class="string">'name'</span>, str));</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>number.</p>
<p>A number cannot start with a decimal point. It must start with a digit,
possibly &#39;0&#39;. (CSA hack: allow numbers to start with a decimal point)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span> ||
                   (c === <span class="string">'.'</span> &amp;&amp;
                    _this_.charAt(i+<span class="number">1</span>) &gt;= <span class="string">'0'</span> &amp;&amp; _this_.charAt(i+<span class="number">1</span>) &lt;= <span class="string">'9'</span>)) {
            <span class="keyword">if</span> (c === <span class="string">'.'</span>) {
                str = <span class="string">''</span>;
            } <span class="keyword">else</span> {
                str = c;
                i += <span class="number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>handle hexadecimal constants [CSA]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                c = _this_.charAt(i);
                <span class="keyword">var</span> isHex = (str===<span class="string">'0'</span> &amp;&amp; c===<span class="string">'x'</span>);
                <span class="keyword">if</span> (isHex) {
                    str += c;
                    i += <span class="number">1</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Look for more digits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">while</span> (<span class="literal">true</span>) {
                    c = _this_.charAt(i);
                    <span class="keyword">if</span> (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>) {
                        <span class="keyword">if</span> (!( isHex &amp;&amp;
                              ( (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'f'</span>) ||
                                (c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'F'</span>) ))) {
                            <span class="keyword">break</span>;
                        }
                    }
                    i += <span class="number">1</span>;
                    str += c;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Look for a decimal fraction part.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (c === <span class="string">'.'</span> &amp;&amp; !isHex) {
                i += <span class="number">1</span>;
                str += c;
                <span class="keyword">while</span> (<span class="literal">true</span>) {
                    c = _this_.charAt(i);
                    <span class="keyword">if</span> (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>) {
                        <span class="keyword">break</span>;
                    }
                    i += <span class="number">1</span>;
                    str += c;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Look for an exponent part.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> ((c === <span class="string">'e'</span> || c === <span class="string">'E'</span>) &amp;&amp; !isHex) {
                i += <span class="number">1</span>;
                str += c;
                c = _this_.charAt(i);
                <span class="keyword">if</span> (c === <span class="string">'-'</span> || c === <span class="string">'+'</span>) {
                    i += <span class="number">1</span>;
                    str += c;
                    c = _this_.charAt(i);
                }
                <span class="keyword">if</span> (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>) {
                    error(make(<span class="string">'number'</span>, str), <span class="string">"Bad exponent"</span>);
                }
                <span class="keyword">while</span> (<span class="literal">true</span>) {
                    i += <span class="number">1</span>;
                    str += c;
                    c = _this_.charAt(i);
                    <span class="keyword">if</span> (! (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>)) {
                        <span class="keyword">break</span>;
                    }
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Make sure the next character is not a letter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) {
                str += c;
                i += <span class="number">1</span>;
                error(make(<span class="string">'number'</span>, str), <span class="string">"Bad number"</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Convert the string value to a number. If it is finite, then it is a good
token.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            n = <span class="number">1</span> * str;
            <span class="keyword">if</span> (isFinite(n)) {
                <span class="keyword">var</span> t = make(<span class="string">'number'</span>, n);
                t.base = isHex ? <span class="number">16</span> : <span class="number">10</span>;
                result.push(t);
            } <span class="keyword">else</span> {
                error(make(<span class="string">'number'</span>, str), <span class="string">"Bad number"</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'\''</span> || c === <span class="string">'"'</span>) {
            str = <span class="string">''</span>;
            q = c;
            i += <span class="number">1</span>;
            <span class="keyword">while</span> (<span class="literal">true</span>) {
                c = _this_.charAt(i);
                <span class="keyword">if</span> (c &lt; <span class="string">' '</span>) {
                    error(make(<span class="string">'string'</span>, str),
                          c === <span class="string">'\n'</span> || c === <span class="string">'\r'</span> || c === <span class="string">''</span> ?
                          <span class="string">"Unterminated string."</span> :
                          <span class="string">"Control character in string."</span><span class="comment">/*, make('', str)*/</span>);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Look for the closing quote.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (c === q) {
                    <span class="keyword">break</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Look for escapement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (c === <span class="string">'\\'</span>) {
                    i += <span class="number">1</span>;
                    <span class="keyword">if</span> (i &gt;= length) {
                        error(make(<span class="string">'string'</span>, str), <span class="string">"Unterminated string"</span>);
                    }
                    c = _this_.charAt(i);
                    <span class="keyword">if</span> (c === <span class="string">'b'</span>) {
                        c = <span class="string">'\b'</span>;
                    } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'f'</span>) {
                        c = <span class="string">'\f'</span>;
                    } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'n'</span>) {
                        c = <span class="string">'\n'</span>;
                    } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'r'</span>) {
                        c = <span class="string">'\r'</span>;
                    } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'t'</span>) {
                        c = <span class="string">'\t'</span>;
                    } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'u'</span>) {
                        <span class="keyword">if</span> (i &gt;= length) {
                            error(make(<span class="string">'string'</span>, str), <span class="string">"Unterminated string"</span>);
                        }
                        c = parseInt(_this_.substring(i + <span class="number">1</span>, i + <span class="number">1</span> + <span class="number">4</span>), <span class="number">16</span>);
                        <span class="keyword">if</span> (!isFinite(c) || c &lt; <span class="number">0</span>) {
                            error(make(<span class="string">'string'</span>, str), <span class="string">"Unterminated string"</span>);
                        }
                        c = String.fromCharCode(c);
                        i += <span class="number">4</span>;
                    }
                }
                str += c;
                i += <span class="number">1</span>;
            }
            i += <span class="number">1</span>;
            result.push(make(<span class="string">'string'</span>, str));
            c = _this_.charAt(i);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>comment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'/'</span> &amp;&amp; _this_.charAt(i + <span class="number">1</span>) === <span class="string">'/'</span>) {
            i += <span class="number">1</span>;
            <span class="keyword">while</span> (<span class="literal">true</span>) {
                c = _this_.charAt(i);
                <span class="keyword">if</span> (c === <span class="string">'\n'</span> || c === <span class="string">'\r'</span> || c === <span class="string">''</span>) {
                    <span class="keyword">break</span>;
                }
                i += <span class="number">1</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>block comment.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (c === <span class="string">'/'</span> &amp;&amp; _this_.charAt(i + <span class="number">1</span>) === <span class="string">'*'</span>) {
            i += <span class="number">3</span>;
            <span class="keyword">while</span> (<span class="literal">true</span>) {
                c = _this_.charAt(i);
                <span class="keyword">if</span> (c === <span class="string">''</span> || (c === <span class="string">'/'</span> &amp;&amp; _this_.charAt(i - <span class="number">1</span>) === <span class="string">'*'</span>)) {
                    i += <span class="number">1</span>;
                    c = _this_.charAt(i);
                    <span class="keyword">break</span>;
                }
                i += <span class="number">1</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>combining</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> <span class="keyword">if</span> (prefix.indexOf(c) &gt;= <span class="number">0</span>) {
            str = c;
            i += <span class="number">1</span>;
            <span class="keyword">while</span> (i &lt; length) {
                c = _this_.charAt(i);
                <span class="keyword">if</span> (suffix.indexOf(c) &lt; <span class="number">0</span>) {
                    <span class="keyword">break</span>;
                }
                str += c;
                i += <span class="number">1</span>;
            }
            result.push(make(<span class="string">'operator'</span>, str));</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>single-character operator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="keyword">else</span> {
            i += <span class="number">1</span>;
            result.push(make(<span class="string">'operator'</span>, c));
            c = _this_.charAt(i);
        }
    }
    <span class="keyword">return</span> result;
};
tokenize.__module_name__ = <span class="string">"tokenize"</span>;
tokenize.__module_init__ = make_tokenize;
tokenize.__module_source__ = tokenize_source;
<span class="keyword">return</span> tokenize;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
